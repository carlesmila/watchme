<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data conversion, summarizing and plotting • watchme</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">watchme</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Overview</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/masalmon/watchme">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Data conversion, summarizing and plotting</h1>
                        <h4 class="author">M. Salmon and other CHAI project members</h4>
            
            <h4 class="date">2017-02-15</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#introduction" class="anchor"> </a></body></html>Introduction</h1>
<p>This package aims at supporting the analysis of annotation results of wearable camera images. The workflow is as follows:</p>
<ul>
<li><p>participants of a study wear a camera that automatically produces pictures;</p></li>
<li><p>these pictures are then annotated by coders using a list of annotations;</p></li>
<li><p>the results of these annotations are then used to e.g. reconstruct the sequence of activities of a person during the day, or link it to pollution exposure.</p></li>
</ul>
<p>This R package supports the last step. This vignette covers the questions “How to convert raw files? How to summarize the data? How to plot the data?”. There’s another vignette dedicated to interrater agreement.</p>
</div>
<div id="data-structure" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#data-structure" class="anchor"> </a></body></html>Data structure</h1>
<p>The structure of data in the package is adapted to data produced using the <a href="https://sensecambrowser.codeplex.com/">Doherty Sensecam Browser for annotation</a> or with data produced using the <a href="http://www.xnview.com/en/xnviewmp/">XnView MP software</a>. However, you can probably re-format your raw data to use the converting function.</p>
<p>The data needed for using the package are:</p>
<ul>
<li>A table of possible annotations, called <code>dico</code>. It contains three columns Code, Meaning, Group. The Code is the unique X-digit identifier of an activity. The Meaning, preferably in a single word such as washingYourTeeth, explains the code. The Group allows to group activities into meaningful categories, i.e. washingYourTeeth and washingYourHands could be in the hygiene Group whereas eatingRealFood and snackingOnCheapChocolate could be in the eating Group. If you do not use abbreviations, Code and Meaning can be equal but in any case they both need to be present.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path_dico &lt;-<span class="st">  </span><span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"dicoCoding_pinocchio.csv"</span>, <span class="dt">package =</span> <span class="st">"watchme"</span>)
sep_dico &lt;-<span class="st"> ";"</span>
dico &lt;-<span class="st"> </span><span class="kw">read.table</span>(path_dico, <span class="dt">sep =</span> sep_dico, <span class="dt">header=</span><span class="ot">TRUE</span>)
dico</code></pre></div>
<pre><code>##   Code            Meaning Group
## 1  01A BiomassCookingUnit     1
## 2  01B           LPGStove     1
## 3  01C   OtherCookingUnit     1
## 4  02B    PresenceKitchen     1
## 5  02A    FoodPreparation     1
## 6  03A             Eating     1
## 7  01.            Cooking    99</code></pre>
<ul>
<li>
<p>A table of coding results. The columns are either:</p>
<ul>
<li><p>name,image_path,image_time,annotation (SQL query of the Doherty browser database, in this case the column name is a repetition of the participant name)</p></li>
<li><p>Filename, EXIF:Date Taken [Y-m-d_H-M-S], IPTC:Keywords (XnView MP)</p></li>
</ul>
</li>
</ul>
<p>The column image_path/Filename indicates the path to the picture, or its name. It only needs to be unique for each picture. The column image_time/EXIF:Date Taken [Y-m-d_H-M-S] gives the date and time at which the picture was taken, in the format “YMD HMS”. The column annotation/IPTC:Keywords gives the code(s) associated with the picture. They can be pasted one after another, since we will use grepl() for finding the unique X-digit identifiers, or they can be on separate lines, since all codes for one picture identified by one picture_name will be merged.</p>
<p>These are the two formats the package were created for:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path_results &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"image_level_pinocchio.csv"</span>, <span class="dt">package =</span> <span class="st">"watchme"</span>)
sep_results &lt;-<span class="st"> ","</span>
coding_results &lt;-<span class="st"> </span><span class="kw">read.table</span>(path_results, <span class="dt">sep =</span> sep_results, <span class="dt">header =</span> <span class="ot">TRUE</span>)
coding_results &lt;-<span class="st"> </span>dplyr::<span class="kw">tbl_df</span>(coding_results)
coding_results %&gt;%<span class="st"> </span><span class="kw">head</span>() %&gt;%<span class="st"> </span>knitr::<span class="kw">kable</span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">name</th>
<th align="left">image_path</th>
<th align="left">image_time</th>
<th align="left">annotation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">pinocchio</td>
<td align="left"></td>
<td align="left">1991-01-23 08:02:00</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">pinocchio</td>
<td align="left">B00000000_21I6LW_20150603_084228E.JPG</td>
<td align="left">2015-06-03 08:42:28</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">pinocchio</td>
<td align="left">015-06-04 08-36-32\B00000001_21I6LW_20150603_084228E.JPG</td>
<td align="left">2015-06-03 08:42:28</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">pinocchio</td>
<td align="left">015-06-04 08-36-32\B00000002_21I6LW_20150603_084236E.JPG</td>
<td align="left">2015-06-03 08:42:36</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">pinocchio</td>
<td align="left">B00000003_21I6LW_20150603_084313E.JPG</td>
<td align="left">2015-06-03 08:43:13</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">pinocchio</td>
<td align="left">B00000004_21I6LW_20150603_084349E.JPG</td>
<td align="left">2015-06-03 08:43:49</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path_results &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"sample_coding1.csv"</span>, <span class="dt">package =</span> <span class="st">"watchme"</span>)
sep_results &lt;-<span class="st"> "</span><span class="ch">\t</span><span class="st">"</span>
coding_results &lt;-<span class="st"> </span><span class="kw">read.table</span>(path_results, <span class="dt">sep =</span> sep_results, <span class="dt">header =</span> <span class="ot">TRUE</span>,
                    <span class="dt">quote  =</span>  <span class="st">"</span><span class="ch">\'</span><span class="st">"</span>)
coding_results &lt;-<span class="st"> </span>dplyr::<span class="kw">tbl_df</span>(coding_results)
coding_results %&gt;%<span class="st"> </span><span class="kw">head</span>() %&gt;%<span class="st"> </span>knitr::<span class="kw">kable</span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">X.Filename.With.Ext</th>
<th align="left">EXIF.Date.Taken..Y.m.d_H.M.S.</th>
<th align="left">IPTC.Keywords</th>
<th align="left">X….</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">“B00000000_21I6LW_20150612_115011E.JPG</td>
<td align="left">2015-06-12_11-49-56</td>
<td align="left">Non codable</td>
<td align="left">“,,,</td>
</tr>
<tr class="even">
<td align="left">“B00000001_21I6LW_20150612_115012E.JPG</td>
<td align="left">2015-06-12_11-49-59</td>
<td align="left">Non codable</td>
<td align="left">“,,,</td>
</tr>
<tr class="odd">
<td align="left">“B00000002_21I6LW_20150612_115013E.JPG</td>
<td align="left">2015-06-12_11-50-01</td>
<td align="left">Non codable</td>
<td align="left">“,,,</td>
</tr>
<tr class="even">
<td align="left">“B00000003_21I6LW_20150612_115014E.JPG</td>
<td align="left">2015-06-12_11-50-04</td>
<td align="left">Non codable</td>
<td align="left">“,,,</td>
</tr>
<tr class="odd">
<td align="left">“B00000004_21I6LW_20150612_115014E.JPG</td>
<td align="left">2015-06-12_11-50-06</td>
<td align="left">Non codable</td>
<td align="left">“,,,</td>
</tr>
<tr class="even">
<td align="left">“B00000005_21I6LW_20150612_115015E.JPG</td>
<td align="left">2015-06-12_11-50-09</td>
<td align="left">Non codable</td>
<td align="left">“,,,</td>
</tr>
</tbody>
</table>
</div>
<div id="from-input-data-to-tibble-data-frames" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#from-input-data-to-tibble-data-frames" class="anchor"> </a></body></html>From input data to <code>tibble</code> data.frames</h1>
<div id="conversion-from-one-coding-file-to-one-data-frame" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#conversion-from-one-coding-file-to-one-data-frame" class="anchor"> </a></body></html>Conversion from one coding file to one data.frame</h2>
<p>Using both these inputs, we create a <code>tibble</code> on which operations will be performed.</p>
<p>The <code>tibble</code> has the following variables:</p>
<ul>
<li><p>participant_id, Name or ID number of the participant (character)</p></li>
<li><p>image_path, Path or name of the image in order to be able to identify duplicates (character)</p></li>
<li><p>image_time, Time and date of each image (POSIXt)</p></li>
<li><p>Columns of Booleans, indicating if a given code was given to a given picture.</p></li>
<li><p><code>the attribute</code> dico, which is a <code>tibble</code>.</p></li>
</ul>
<p>The function used to create such a <code>tibble</code> is called <code>watchme_prepare_data</code>.</p>
<p>For finding both inputs and interpreting them the <code>watchme_prepare_data</code> function needs to know the paths to each file, <code>path_results</code> and <code>path_dico</code> and the separator used in each of them, <code>sep_results</code> and <code>sep_dico</code>, as well as the timezone corresponding to <code>image_time</code>. <code>sep_results</code> and <code>sep_dico</code> might seem to be a bit of a hassle but we wanted to accomodate for different formats.</p>
<p>Below we illustrate the use of <code>watchme_prepare_data</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"watchme"</span>)
path_results &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"sample_coding1.csv"</span>, <span class="dt">package =</span> <span class="st">"watchme"</span>)
sep_results &lt;-<span class="st"> "</span><span class="ch">\t</span><span class="st">"</span>
path_dico &lt;-<span class="st">  </span><span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"dico_coding_2016_01.csv"</span>, <span class="dt">package =</span> <span class="st">"watchme"</span>)
sep_dico &lt;-<span class="st"> ";"</span>
results_table &lt;-<span class="st"> </span><span class="kw"><a href="../reference/watchme_prepare_data.html">watchme_prepare_data</a></span>(<span class="dt">path_results=</span>path_results, <span class="dt">sep_results=</span>sep_results,
              <span class="dt">path_dico=</span>path_dico, <span class="dt">sep_dico=</span>sep_dico, <span class="dt">tz =</span> <span class="st">"Asia/Kolkata"</span>)
results_table %&gt;%<span class="st"> </span><span class="kw">head</span>() %&gt;%<span class="st"> </span>knitr::<span class="kw">kable</span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">image_path</th>
<th align="left">image_time</th>
<th align="left">participant_id</th>
<th align="left">biomass_cooking_unit</th>
<th align="left">lpg_stove</th>
<th align="left">other_cooking_unit</th>
<th align="left">food_preparation</th>
<th align="left">eating_</th>
<th align="left">presence_in_the_kitchen</th>
<th align="left">travel_by_bus</th>
<th align="left">travel_by_bicycle</th>
<th align="left">travel_by_auto</th>
<th align="left">travel_by_motorcycle</th>
<th align="left">participant_presence_on_road</th>
<th align="left">presence_at_office_or_shop</th>
<th align="left">presence_at_work_field</th>
<th align="left">presence_in_industry</th>
<th align="left">presence_in_informal_work</th>
<th align="left">diesel_generator</th>
<th align="left">smoking</th>
<th align="left">visible_flame_or_smoke</th>
<th align="left">indoors</th>
<th align="left">outdoors</th>
<th align="left">in_vehicle</th>
<th align="left">mixed</th>
<th align="left">non_codable</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">“B00000000_21I6LW_20150612_115011E.JPG</td>
<td align="left">2015-06-12 11:49:56</td>
<td align="left">no_id</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">“B00000001_21I6LW_20150612_115012E.JPG</td>
<td align="left">2015-06-12 11:49:59</td>
<td align="left">no_id</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">“B00000002_21I6LW_20150612_115013E.JPG</td>
<td align="left">2015-06-12 11:50:01</td>
<td align="left">no_id</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">“B00000003_21I6LW_20150612_115014E.JPG</td>
<td align="left">2015-06-12 11:50:04</td>
<td align="left">no_id</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">“B00000004_21I6LW_20150612_115014E.JPG</td>
<td align="left">2015-06-12 11:50:06</td>
<td align="left">no_id</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">“B00000005_21I6LW_20150612_115015E.JPG</td>
<td align="left">2015-06-12 11:50:09</td>
<td align="left">no_id</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
<p>In the case of the CHAI project, we had many coding results files from XnView MP and some of them had annotations spread over several columns. Because of this we added the <code>robust_reading</code> option which is FALSE by default. When TRUE each results file is read twice, once for finding image_path and image_time (which need to be the first and second column, respectively), once for finding annotation by considering each line as a single variable. This way we didn’t need to care too much about the number of columns of annotations, even if in theory it should have been one column only.</p>
</div>
<div id="conversion-from-several-coding-files-to-one-data-frame" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#conversion-from-several-coding-files-to-one-data-frame" class="anchor"> </a></body></html>Conversion from several coding files to one data.frame</h2>
<p>In the CHAI project, annotation of pictures was performed in several passes: in a first pass, coders looked at the set of pictures and assigned indoor/outdoor location for instance, in a second one they assigned code from the cooking group, etc. Each pass led to one file. So all results from one participant-day were contained in 5 coding files. Because of this, we wrote a function for being able to combine them. The steps were the following:</p>
<ol style="list-style-type: decimal">
<li><p>For each pass, generate a coding tibble with a dico as attribute via the use of <code><a href="../reference/watchme_prepare_data.html">watchme_prepare_data()</a></code>. For this we used one dico per pass where only the codes of that group (e.g. only cooking codes) were described.</p></li>
<li><p>Use the <code>watchme_combine_results</code> function on the list of these 5 tibbles. <code>common_codes</code> in this case was only the “uncodable” picture code, all other columns had to present in only one of the tibble. For the merging to work, all 5 tibbles need to have the exact same image_time.</p></li>
</ol>
<p>Here is one example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">passes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"CK"</span>, <span class="st">"IO"</span>, <span class="st">"OP"</span>, <span class="st">"PM"</span>, <span class="st">"TP"</span>)

create_pass_results &lt;-<span class="st"> </span>function(pass){
  path_results &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">'extdata'</span>, <span class="kw">paste0</span>(<span class="st">"oneday_"</span>, pass, <span class="st">".csv"</span>),
  <span class="dt">package =</span> <span class="st">'watchme'</span>)
  sep_results &lt;-<span class="st"> "</span><span class="ch">\t</span><span class="st">"</span>
  path_dico &lt;-<span class="st">  </span><span class="kw">system.file</span>(<span class="st">'extdata'</span>, <span class="kw">paste0</span>(<span class="st">"dico_coding_2016_01_"</span>, pass, <span class="st">".csv"</span>),
   <span class="dt">package =</span> <span class="st">'watchme'</span>)
  sep_dico &lt;-<span class="st"> ';'</span>

  results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/watchme_prepare_data.html">watchme_prepare_data</a></span>(<span class="dt">path_results =</span> path_results,
                                  <span class="dt">sep_results =</span> sep_results,
                                  <span class="dt">path_dico =</span> path_dico,
                                  <span class="dt">sep_dico =</span> sep_dico,
                                  <span class="dt">tz =</span> <span class="st">"Asia/Kolkata"</span>)
  results$image_path &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">'</span><span class="ch">\"</span><span class="st">'</span>, <span class="st">""</span>, results$image_path)
  results
}

results_list &lt;-<span class="st"> </span>passes %&gt;%<span class="st"> </span>purrr::<span class="kw">map</span>(create_pass_results)
results_list[[<span class="dv">1</span>]]</code></pre></div>
<pre><code>## # A tibble: 1,665 × 10
##                           image_path          image_time participant_id
##                                &lt;chr&gt;              &lt;dttm&gt;          &lt;chr&gt;
## 1  B00000000_21I6LU_20150527_073822E 2015-05-27 07:38:01          no_id
## 2  B00000001_21I6LU_20150527_073823E 2015-05-27 07:38:04          no_id
## 3  B00000002_21I6LU_20150527_073824E 2015-05-27 07:38:06          no_id
## 4  B00000003_21I6LU_20150527_073825E 2015-05-27 07:38:09          no_id
## 5  B00000004_21I6LU_20150527_073826E 2015-05-27 07:38:12          no_id
## 6  B00000005_21I6LU_20150527_073826E 2015-05-27 07:38:14          no_id
## 7  B00000006_21I6LU_20150527_073826E 2015-05-27 07:38:17          no_id
## 8  B00000007_21I6LU_20150527_073827E 2015-05-27 07:38:19          no_id
## 9  B00000008_21I6LU_20150527_073828E 2015-05-27 07:38:22          no_id
## 10 B00000009_21I6LU_20150527_080738E 2015-05-27 08:07:37          no_id
## # ... with 1,655 more rows, and 7 more variables:
## #   biomass_cooking_unit &lt;lgl&gt;, lpg_stove &lt;lgl&gt;, other_cooking_unit &lt;lgl&gt;,
## #   food_preparation &lt;lgl&gt;, eating &lt;lgl&gt;, presence_in_the_kitchen &lt;lgl&gt;,
## #   non_codable &lt;lgl&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">oneday_results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/watchme_combine_results.html">watchme_combine_results</a></span>(results_list,
<span class="dt">common_codes =</span> <span class="st">"non_codable"</span>)
oneday_results</code></pre></div>
<pre><code>## # A tibble: 1,665 × 26
##                           image_path          image_time participant_id
##                                &lt;chr&gt;              &lt;dttm&gt;          &lt;chr&gt;
## 1  B00000000_21I6LU_20150527_073822E 2015-05-27 07:38:01          no_id
## 2  B00000001_21I6LU_20150527_073823E 2015-05-27 07:38:04          no_id
## 3  B00000002_21I6LU_20150527_073824E 2015-05-27 07:38:06          no_id
## 4  B00000003_21I6LU_20150527_073825E 2015-05-27 07:38:09          no_id
## 5  B00000004_21I6LU_20150527_073826E 2015-05-27 07:38:12          no_id
## 6  B00000005_21I6LU_20150527_073826E 2015-05-27 07:38:14          no_id
## 7  B00000006_21I6LU_20150527_073826E 2015-05-27 07:38:17          no_id
## 8  B00000007_21I6LU_20150527_073827E 2015-05-27 07:38:19          no_id
## 9  B00000008_21I6LU_20150527_073828E 2015-05-27 07:38:22          no_id
## 10 B00000009_21I6LU_20150527_080738E 2015-05-27 08:07:37          no_id
## # ... with 1,655 more rows, and 23 more variables:
## #   biomass_cooking_unit &lt;lgl&gt;, lpg_stove &lt;lgl&gt;, other_cooking_unit &lt;lgl&gt;,
## #   food_preparation &lt;lgl&gt;, eating &lt;lgl&gt;, presence_in_the_kitchen &lt;lgl&gt;,
## #   indoors &lt;lgl&gt;, outdoors &lt;lgl&gt;, in_vehicle &lt;lgl&gt;, mixed &lt;lgl&gt;,
## #   presence_at_office_or_shop &lt;lgl&gt;, presence_at_work_field &lt;lgl&gt;,
## #   presence_in_industry &lt;lgl&gt;, presence_in_informal_work &lt;lgl&gt;,
## #   diesel_generator &lt;lgl&gt;, smoking &lt;lgl&gt;, visible_flame_or_smoke &lt;lgl&gt;,
## #   travel_by_bus &lt;lgl&gt;, travel_by_bicycle &lt;lgl&gt;, travel_by_auto &lt;lgl&gt;,
## #   travel_by_motorcycle &lt;lgl&gt;, participant_presence_on_road &lt;lgl&gt;,
## #   non_codable &lt;lgl&gt;</code></pre>
</div>
<div id="plotting" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#plotting" class="anchor"> </a></body></html>Plotting</h2>
<p>There is a default function based on <code>ggplot2</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/watchme_plot_raw.html">watchme_plot_raw</a></span>(results_table)</code></pre></div>
<pre><code>## Warning: Removed 1606 rows containing missing values (geom_point).</code></pre>
<p><img src="intro_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
</div>
</div>
<div id="from-the-coding-results-to-table-of-events" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#from-the-coding-results-to-table-of-events" class="anchor"> </a></body></html>From the coding results to table of events</h1>
<div id="conversion" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#conversion" class="anchor"> </a></body></html>Conversion</h2>
<p>Using the annotations from the images, when can easily deduce a sequence of events. For instance having two subsequent pictures of washingYourTeeth taken at respectively t1 and t2 could be interpreted as having a washingYourTeeth event from t1 to t2. The <code>watchme_aggregate</code> allows the conversion from a <code>wearableCamImages</code> object to a table (<code>dplyr</code> class <code>tbl_df</code>) with</p>
<ul>
<li><p>event_code, group, meaning</p></li>
<li><p>start_time (<code>POSIXt</code>),</p></li>
<li><p>end_time (<code>POSIXt</code>),</p></li>
<li><p>start_picture and end_picture,</p></li>
<li><p>no_pictures in the event,</p></li>
<li><p>duration in seconds.</p></li>
</ul>
<p>If pictures have several codes, then there can be synchronous events.</p>
<p>The function <code>watchme_aggregate</code> takes two arguments: a <code>tibble</code> created by <code>watchme_prepare_data</code> and a minimal duration for the events, in pictures, which is called <code>min_no_pictures</code>. Below are two examples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">"coding_example"</span>)
eventTable &lt;-<span class="st"> </span><span class="kw"><a href="../reference/watchme_aggregate.html">watchme_aggregate</a></span>(<span class="dt">df =</span> coding_example)
knitr::<span class="kw">kable</span>(<span class="kw">head</span>(eventTable))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">event_code</th>
<th align="left">start_time</th>
<th align="left">end_time</th>
<th align="right">no_pictures</th>
<th align="right">start_picture</th>
<th align="right">end_picture</th>
<th align="left">group</th>
<th align="left">meaning</th>
<th align="right">duration</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01.</td>
<td align="left">2015-06-03 08:45:09</td>
<td align="left">2015-06-03 08:45:09</td>
<td align="right">1</td>
<td align="right">7</td>
<td align="right">7</td>
<td align="left">99</td>
<td align="left">cooking</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01.</td>
<td align="left">2015-06-03 09:13:34</td>
<td align="left">2015-06-03 09:13:34</td>
<td align="right">1</td>
<td align="right">50</td>
<td align="right">50</td>
<td align="left">99</td>
<td align="left">cooking</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01.</td>
<td align="left">2015-06-03 09:15:24</td>
<td align="left">2015-06-03 09:15:24</td>
<td align="right">1</td>
<td align="right">53</td>
<td align="right">53</td>
<td align="left">99</td>
<td align="left">cooking</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01.</td>
<td align="left">2015-06-03 09:16:46</td>
<td align="left">2015-06-03 09:22:23</td>
<td align="right">8</td>
<td align="right">55</td>
<td align="right">62</td>
<td align="left">99</td>
<td align="left">cooking</td>
<td align="right">337</td>
</tr>
<tr class="odd">
<td align="left">01.</td>
<td align="left">2015-06-03 09:37:20</td>
<td align="left">2015-06-03 09:37:53</td>
<td align="right">2</td>
<td align="right">81</td>
<td align="right">82</td>
<td align="left">99</td>
<td align="left">cooking</td>
<td align="right">33</td>
</tr>
<tr class="even">
<td align="left">01.</td>
<td align="left">2015-06-03 10:48:40</td>
<td align="left">2015-06-03 10:48:40</td>
<td align="right">1</td>
<td align="right">180</td>
<td align="right">180</td>
<td align="left">99</td>
<td align="left">cooking</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eventTable2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/watchme_aggregate.html">watchme_aggregate</a></span>(<span class="dt">df =</span> coding_example, <span class="dt">min_no_pictures =</span> <span class="dv">2</span>)
knitr::<span class="kw">kable</span>(<span class="kw">head</span>(eventTable2))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">event_code</th>
<th align="left">start_time</th>
<th align="left">end_time</th>
<th align="right">no_pictures</th>
<th align="right">start_picture</th>
<th align="right">end_picture</th>
<th align="left">group</th>
<th align="left">meaning</th>
<th align="right">duration</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01.</td>
<td align="left">2015-06-03 09:16:46</td>
<td align="left">2015-06-03 09:22:23</td>
<td align="right">8</td>
<td align="right">55</td>
<td align="right">62</td>
<td align="left">99</td>
<td align="left">cooking</td>
<td align="right">337</td>
</tr>
<tr class="even">
<td align="left">01.</td>
<td align="left">2015-06-03 09:37:20</td>
<td align="left">2015-06-03 09:37:53</td>
<td align="right">2</td>
<td align="right">81</td>
<td align="right">82</td>
<td align="left">99</td>
<td align="left">cooking</td>
<td align="right">33</td>
</tr>
<tr class="odd">
<td align="left">01.</td>
<td align="left">2015-06-03 13:21:36</td>
<td align="left">2015-06-03 13:22:43</td>
<td align="right">3</td>
<td align="right">309</td>
<td align="right">311</td>
<td align="left">99</td>
<td align="left">cooking</td>
<td align="right">67</td>
</tr>
<tr class="even">
<td align="left">01.</td>
<td align="left">2015-06-03 15:06:04</td>
<td align="left">2015-06-03 15:06:47</td>
<td align="right">2</td>
<td align="right">449</td>
<td align="right">450</td>
<td align="left">99</td>
<td align="left">cooking</td>
<td align="right">43</td>
</tr>
<tr class="odd">
<td align="left">01.</td>
<td align="left">2015-06-04 06:13:30</td>
<td align="left">2015-06-04 06:16:37</td>
<td align="right">5</td>
<td align="right">801</td>
<td align="right">805</td>
<td align="left">99</td>
<td align="left">cooking</td>
<td align="right">187</td>
</tr>
<tr class="even">
<td align="left">01.</td>
<td align="left">2015-06-04 06:21:13</td>
<td align="left">2015-06-04 06:35:26</td>
<td align="right">19</td>
<td align="right">811</td>
<td align="right">829</td>
<td align="left">99</td>
<td align="left">cooking</td>
<td align="right">853</td>
</tr>
</tbody>
</table>
</div>
<div id="plotting-a-table-of-events" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#plotting-a-table-of-events" class="anchor"> </a></body></html>Plotting a table of events</h2>
<p>The package provides a function using the R <code>ggplot2</code> package for plotting sequences of events.</p>
<p>Below are three examples. In the example we give there’s only one group of codes, indoor_outdoor, where codes are incompatible, but if plotting several groups of codes, one can use facetting.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">"coding1"</span>)
event_table &lt;-<span class="st"> </span><span class="kw"><a href="../reference/watchme_aggregate.html">watchme_aggregate</a></span>(<span class="dt">df =</span> coding1)
<span class="kw"><a href="../reference/watchme_plot_sequence.html">watchme_plot_sequence</a></span>(event_table)</code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-8-1.png" width="960"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/watchme_plot_sequence.html">watchme_plot_sequence</a></span>(event_table, <span class="dt">x_axis =</span> <span class="st">"picture"</span>)</code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-8-2.png" width="960"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/watchme_plot_sequence.html">watchme_plot_sequence</a></span>(event_table, <span class="dt">x_axis =</span> <span class="st">"picture"</span>) +
<span class="st">  </span><span class="kw">facet_grid</span>(group ~<span class="st"> </span>.)</code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-8-3.png" width="960"></p>
<p>For plotting results from more than one coder, one could do this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">"coding1"</span>)
<span class="kw">data</span>(<span class="st">"coding2"</span>)
dico &lt;-<span class="st"> </span><span class="kw">attr</span>(coding1, <span class="st">"dico"</span>)
event_table1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/watchme_aggregate.html">watchme_aggregate</a></span>(<span class="dt">df =</span> coding1)
event_table1 &lt;-<span class="st"> </span><span class="kw">mutate</span>(event_table1, <span class="dt">coder =</span> <span class="st">"coder1"</span>)

event_table2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/watchme_aggregate.html">watchme_aggregate</a></span>(<span class="dt">df =</span> coding2)
event_table2 &lt;-<span class="st"> </span><span class="kw">mutate</span>(event_table2, <span class="dt">coder =</span> <span class="st">"coder2"</span>)

event_table &lt;-<span class="st"> </span>dplyr::<span class="kw">bind_rows</span>(event_table1, event_table2)

<span class="kw">attr</span>(event_table, <span class="st">"dico"</span>) &lt;-<span class="st"> </span>dico
<span class="kw"><a href="../reference/watchme_plot_sequence.html">watchme_plot_sequence</a></span>(event_table) +
<span class="st">  </span><span class="kw">facet_grid</span>(coder ~<span class="st"> </span>.)</code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-9-1.png" width="960"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#data-structure">Data structure</a></li>
      <li>
<a href="#from-input-data-to-tibble-data.frames">From input data to <code>tibble</code> data.frames</a><ul class="nav nav-pills nav-stacked">
<li><a href="#conversion-from-one-coding-file-to-one-data.frame">Conversion from one coding file to one data.frame</a></li>
      <li><a href="#conversion-from-several-coding-files-to-one-data.frame">Conversion from several coding files to one data.frame</a></li>
      <li><a href="#plotting">Plotting</a></li>
      </ul>
</li>
      <li>
<a href="#from-the-coding-results-to-table-of-events">From the coding results to table of events</a><ul class="nav nav-pills nav-stacked">
<li><a href="#conversion">Conversion</a></li>
      <li><a href="#plotting-a-table-of-events">Plotting a table of events</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Maëlle Salmon,  ERC Grant Agreement number 336167 - the CHAI Project.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
